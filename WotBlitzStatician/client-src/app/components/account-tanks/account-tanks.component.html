<form (ngSubmit)="queryData()">
  <div class="form-row form-inline">
    <div class="btn-group btn-group-toggle" id="tiersToggle" title="Уровни танков">
      <label [ngClass]="'btn btn-light' + (tier.isSelected ? ' active' : '')" *ngFor="let tier of filter.tires">
        <input type="checkbox" [ngModelOptions]="{standalone: true}" class="checkbox-empty" autocomplete="off" [(ngModel)]="tier.isSelected">{{tier.itemName}}
      </label>
    </div>
    <div class="btn-group btn-group-toggle" id="inGarageToggle" title="В гараже">
      <label [ngClass]="'btn btn-light' + (filter.inGarage ? ' active' : '')">
        <input type="checkbox" [ngModelOptions]="{standalone: true}" autocomplete="off" [(ngModel)]="filter.inGarage" class="checkbox-empty"><fa-icon icon="warehouse"></fa-icon>
      </label>
    </div>
    <div class="input-group mb-2 mr-sm-2" title="Боев >">
      <input type="number" [ngModelOptions]="{standalone: true}" class="form-control" id="minBattles" [(ngModel)]="filter.minBattles" placeholder="100">
    </div>
    <div class="input-group mb-2 mr-sm-2" title="Последний бой с:">
      <input type="date" [ngModelOptions]="{standalone: true}" class="form-control" id="dateFrom" [(ngModel)]="filter.dataFrom">
    </div>
  </div>
  <div class="form-row">
    <div class="btn-group btn-group-toggle" id="vehicleTypesToggle" title="Типы танков">
      <label [ngClass]="'btn btn-light' + (vehicleType.isSelected ? ' active' : '')" *ngFor="let vehicleType of filter.vehicleTypes">
        <input type="checkbox" [ngModelOptions]="{standalone: true}" class="checkbox-empty" autocomplete="off" [(ngModel)]="vehicleType.isSelected"><img [ngClass]="'tank-type-' + vehicleType.itemName" />
      </label>
    </div>
    <div class="btn-group btn-group-toggle" id="nationsToggle" title="Нации">
      <label [ngClass]="'btn btn-light' + (nation.isSelected ? ' active' : '')" *ngFor="let nation of filter.nations">
        <input type="checkbox" [ngModelOptions]="{standalone: true}" class="checkbox-empty" autocomplete="off" [(ngModel)]="nation.isSelected"><img [ngClass]="'flag-' + nation.itemName" />
      </label>
    </div>
    <button class="btn btn-light" type="submit" title="Применить фильтр">
      <fa-icon icon="search"></fa-icon>
    </button>
  </div>
</form>
<div class="tanks-table">
  <table class="table">
    <thead>
      <tr>
        <th (click)="sortColumn = 'TankMarkOfMastery'; sortAscending = !sortAscending; sortTanks();">
          <fa-icon *ngIf="sortColumn == 'TankMarkOfMastery' && !sortAscending" icon="angle-down"></fa-icon>
          <fa-icon *ngIf="sortColumn == 'TankMarkOfMastery' && sortAscending" icon="angle-up"></fa-icon>
        </th>
        <th (click)="sortColumn = 'VehicleType'; sortAscending = !sortAscending; sortTanks();">
          <fa-icon *ngIf="sortColumn == 'VehicleType' && !sortAscending" icon="angle-down"></fa-icon>
          <fa-icon *ngIf="sortColumn == 'VehicleType' && sortAscending" icon="angle-up"></fa-icon>
        </th>
        <th (click)="sortColumn = 'VehicleTier'; sortAscending = !sortAscending; sortTanks();">
          <fa-icon *ngIf="sortColumn == 'VehicleTier' && !sortAscending" icon="angle-down"></fa-icon>
          <fa-icon *ngIf="sortColumn == 'VehicleTier' && sortAscending" icon="angle-up"></fa-icon>
        </th>
        <th (click)="sortColumn = 'VehicleNation'; sortAscending = !sortAscending; sortTanks();">
          <fa-icon *ngIf="sortColumn == 'VehicleNation' && !sortAscending" icon="angle-down"></fa-icon>
          <fa-icon *ngIf="sortColumn == 'VehicleNation' && sortAscending" icon="angle-up"></fa-icon>
        </th>
        <th>
          Tank
        </th>
        <th (click)="sortColumn = 'TankBattles'; sortAscending = !sortAscending; sortTanks();">
          <fa-icon icon="gamepad"></fa-icon> 
          <fa-icon *ngIf="sortColumn == 'TankBattles' && !sortAscending" icon="angle-down"></fa-icon>
          <fa-icon *ngIf="sortColumn == 'TankBattles' && sortAscending" icon="angle-up"></fa-icon>
        </th>
        <th (click)="sortColumn = 'WinRate'; sortAscending = !sortAscending; sortTanks();">
          <fa-icon icon="flag"></fa-icon>  
          <fa-icon *ngIf="sortColumn == 'WinRate' && !sortAscending" icon="angle-down"></fa-icon>
          <fa-icon *ngIf="sortColumn == 'WinRate' && sortAscending" icon="angle-up"></fa-icon>
        </th>
        <th (click)="sortColumn = 'TankWn7'; sortAscending = !sortAscending; sortTanks();">
          <fa-icon icon="calculator" size="xs"></fa-icon> Wn7
          <fa-icon *ngIf="sortColumn == 'TankWn7' && !sortAscending" icon="angle-down"></fa-icon>
          <fa-icon *ngIf="sortColumn == 'TankWn7' && sortAscending" icon="angle-up"></fa-icon>
        </th>
        <th (click)="sortColumn = 'AvgDamage'; sortAscending = !sortAscending; sortTanks();">
          <fa-icon icon="skull-crossbones"></fa-icon>
          <fa-icon *ngIf="sortColumn == 'AvgDamage' && !sortAscending" icon="angle-down"></fa-icon>
          <fa-icon *ngIf="sortColumn == 'AvgDamage' && sortAscending" icon="angle-up"></fa-icon>
        </th>
        <th (click)="sortColumn = 'AvgXp'; sortAscending = !sortAscending; sortTanks();">
          <fa-icon [icon]="['far', 'star']"></fa-icon> 
          <fa-icon *ngIf="sortColumn == 'AvgXp' && !sortAscending" icon="angle-down"></fa-icon>
          <fa-icon *ngIf="sortColumn == 'AvgXp' && sortAscending" icon="angle-up"></fa-icon>
        </th>  
        <th (click)="sortColumn = 'SurvivalRate'; sortAscending = !sortAscending; sortTanks();">
          <fa-icon [icon]="['far', 'heart']"></fa-icon> 
          <fa-icon *ngIf="sortColumn == 'SurvivalRate' && !sortAscending" icon="angle-down"></fa-icon>
          <fa-icon *ngIf="sortColumn == 'SurvivalRate' && sortAscending" icon="angle-up"></fa-icon>
        </th>
        <th (click)="sortColumn = 'TankLastBattleTime'; sortAscending = !sortAscending; sortTanks();">
          <fa-icon [icon]="['far', 'clock']"></fa-icon> 
          <fa-icon *ngIf="sortColumn == 'TankLastBattleTime' && !sortAscending" icon="angle-down"></fa-icon>
          <fa-icon *ngIf="sortColumn == 'TankLastBattleTime' && sortAscending" icon="angle-up"></fa-icon>
        </th>
        <th>
          <fa-icon icon="warehouse"></fa-icon>
        </th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let tank of tanks; trackBy: trackByTankId">
        <td><img *ngIf="tank.TankMarkOfMastery != 'None'" [ngClass]="'mastery-' + tank.TankMarkOfMastery" /></td>
        <td><img [ngClass]="'tank-type-' + tank.VehicleType + (tank.VehicleIsPremium ? '-prem' : '')" /></td>
        <td><b>{{tank.TankTierRoman}}</b></td>
        <td><img [ngClass]="'flag-' + tank.VehicleNation" /></td>
        <td><img src="{{tank.PreviewLocalImage}}" class="tank-image" /> {{tank.VehicleName}}</td>
        <td>{{tank.TankBattles|number}}</td>
        <td [appBlitzColorScale]="tank.WinRate">{{tank.WinRate|percent:'2.2-2'}}</td>
        <td [appBlitzColorScale]="tank.TankWn7">{{tank.TankWn7|number:'3.0-0'}}</td>
        <td>{{tank.AvgDamage|number:'3.0-0'}}</td>
        <td>{{tank.AvgXp|number:'3.0-0'}}</td>
        <td>{{tank.SurvivalRate|percent:'2.2-2'}}</td>
        <td>{{tank.TankLastBattleTime|date:"short"}}</td>
        <td><fa-icon *ngIf="tank.TankInGarage" icon="warehouse" size="xs"></fa-icon></td>
      </tr>
    </tbody>
    <tfoot>
      <tr>
        <th></th>
        <th>{{tanks.length|number}}</th>
        <th>{{tableFooter.avgTier|number:'1.0-1'}}</th>
        <th colspan="2"></th>
        <th>{{tableFooter.battlesSum|number}}</th>
        <th [appBlitzColorScale]="tableFooter.avgWinrate">{{tableFooter.avgWinrate|percent:'2.2-2'}}</th>
        <th [appBlitzColorScale]="tableFooter.avgWn7">{{tableFooter.avgWn7|number:'3.0-0'}}</th>
        <th>{{tableFooter.avgDamage|number:'3.0-0'}}</th>
        <th>{{tableFooter.avgXp|number:'3.0-0'}}</th>
        <th></th>
        <th></th>
        <th></th>
      </tr>
    </tfoot>
  </table>
</div>
